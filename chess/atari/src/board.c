/**
 * @brief   #FujiNet Chess
 * @author  Thomas Cherryhomes
 * @email   thom dot cherryhomes at gmail dot com
 * @license gpl v. 3, see LICENSE.md for details.
 * @verbose Board routines
 */

#include <atari.h>
#include <string.h>
#include <conio.h>
#include <stdio.h>

#define DLIST_ADDR   0x0600      // Display list address in memory
#define PMG_ADDR     0x7C00      // PM/G base address
#define CHSET_ADDR   0x7A00      // Character set base address
#define BOARDPF_ADDR 0x8000      // Board playfield address
#define MSGPF_ADDR   0x81E0      // Message playfield address.

#define MSG ((unsigned char*)0x81E0)

/**
 * @brief Board display list
 */
static const void _dlist =
  {
    DL_BLK8,
    DL_BLK8,
    DL_BLK5,
    
    DL_LMS(DL_CHR20x8x2),
    MSGPF_ADDR,
    DL_BLK3,
    
    DL_LMS(DL_CHR20x8x2),
    BOARDPF_ADDR,
    DL_BLK2,

    DL_CHR20x8x2,
    DL_CHR20x8x2,
    DL_BLK6,    
    DL_CHR20x8x2,
    DL_CHR20x8x2,
    DL_BLK6,
    DL_CHR20x8x2,
    DL_CHR20x8x2,
    DL_BLK6,
    DL_CHR20x8x2,
    DL_CHR20x8x2,
    DL_BLK6,
    DL_CHR20x8x2,
    DL_CHR20x8x2,
    DL_BLK6,
    DL_CHR20x8x2,
    DL_CHR20x8x2,
    DL_BLK6,
    DL_CHR20x8x2,
    DL_CHR20x8x2,
    DL_BLK6,
    DL_CHR20x8x2,
    DL_CHR20x8x2,

    DL_BLK2,
    DL_CHR20x8x2,
    
    DL_JVB,
    DLIST_ADDR
  };

/**
 * @brief Board players/missiles to copy to 0x7C00
 */
static const unsigned char _pmg_data[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2e, 0x2e, 0x2e, 0x0a,
  0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a,
  0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a,
  0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a,
  0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a,
  0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a,
  0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a,
  0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a,
  0x0a, 0x0a, 0x0a, 0x2e, 0x2e, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0,
  0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f,
  0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0,
  0xf0, 0xf0, 0xf0, 0xf0, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f,
  0x0f, 0x0f, 0x0f, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0,
  0xf0, 0xf0, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f,
  0x0f, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0,
  0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0,
  0xf0, 0xf0, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f,
  0x0f, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0,
  0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0xf0,
  0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0x0f, 0x0f,
  0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0xf0, 0xf0, 0xf0,
  0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0x0f, 0x0f, 0x0f, 0x0f,
  0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0,
  0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0x0f, 0x0f,
  0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0xf0, 0xf0, 0xf0,
  0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0x0f, 0x0f, 0x0f, 0x0f,
  0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0,
  0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f,
  0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0,
  0xf0, 0xf0, 0xf0, 0xf0, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f,
  0x0f, 0x0f, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0,
  0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f,
  0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0,
  0xf0, 0xf0, 0xf0, 0xf0, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f,
  0x0f, 0x0f, 0x0f, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0,
  0xf0, 0xf0, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f,
  0x0f, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0,
  0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00
};

/**
 * @brief mode 6 chess piece/uppercase alpha font
 */
unsigned char _board_fnt[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x7e, 0x7e, 0x18, 0x5a, 0xff, 0xff,
  0xff, 0x7e, 0x3c, 0x3c, 0x3c, 0x3c, 0x7e, 0xff, 0x00, 0x00, 0x10, 0x38,
  0xba, 0xfe, 0xfe, 0xfe, 0x7c, 0x7c, 0x38, 0x38, 0x38, 0x7c, 0xfe, 0xfe,
  0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x38, 0x74, 0xee, 0xfe, 0xfe, 0x7c,
  0x38, 0x38, 0x7c, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x1c, 0x34,
  0x3e, 0x3f, 0x7f, 0x76, 0x78, 0x78, 0xfc, 0xfe, 0x00, 0x00, 0x00, 0x00,
  0x54, 0x54, 0x7c, 0x7c, 0x38, 0x38, 0x38, 0x38, 0x38, 0x7c, 0x7c, 0xfe,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x3c, 0x3c, 0x18,
  0x18, 0x3c, 0x3c, 0x7e, 0xff, 0x7e, 0x3c, 0x3c, 0x3c, 0x3c, 0x7f, 0xff,
  0xff, 0xff, 0x5a, 0x18, 0x7e, 0x7e, 0x18, 0x18, 0x00, 0x3c, 0x66, 0x6e,
  0x76, 0x66, 0x3c, 0x00, 0x00, 0x18, 0x38, 0x18, 0x18, 0x18, 0x7e, 0x00,
  0x00, 0x3c, 0x66, 0x0c, 0x18, 0x30, 0x7e, 0x00, 0x00, 0x7e, 0x0c, 0x18,
  0x0c, 0x66, 0x3c, 0x00, 0x00, 0x0c, 0x1c, 0x3c, 0x6c, 0x7e, 0x0c, 0x00,
  0x00, 0x7e, 0x60, 0x7c, 0x06, 0x66, 0x3c, 0x00, 0x00, 0x3c, 0x60, 0x7c,
  0x66, 0x66, 0x3c, 0x00, 0x00, 0x7e, 0x06, 0x0c, 0x18, 0x30, 0x30, 0x00,
  0x00, 0x3c, 0x66, 0x3c, 0x66, 0x66, 0x3c, 0x00, 0x00, 0x3c, 0x66, 0x3e,
  0x06, 0x0c, 0x38, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x06, 0x0c, 0x18, 0x30,
  0x18, 0x0c, 0x06, 0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x7e, 0x00, 0x00,
  0x60, 0x30, 0x18, 0x0c, 0x18, 0x30, 0x60, 0x00, 0x00, 0x3c, 0x66, 0x0c,
  0x18, 0x00, 0x18, 0x00, 0x00, 0x3c, 0x66, 0x6e, 0x6e, 0x60, 0x3e, 0x00,
  0x00, 0x18, 0x3c, 0x66, 0x66, 0x7e, 0x66, 0x00, 0x00, 0x7c, 0x66, 0x7c,
  0x66, 0x66, 0x7c, 0x00, 0x00, 0x3c, 0x66, 0x60, 0x60, 0x66, 0x3c, 0x00,
  0x00, 0x78, 0x6c, 0x66, 0x66, 0x6c, 0x78, 0x00, 0x00, 0x7e, 0x60, 0x7c,
  0x60, 0x60, 0x7e, 0x00, 0x00, 0x7e, 0x60, 0x7c, 0x60, 0x60, 0x60, 0x00,
  0x00, 0x3e, 0x60, 0x60, 0x6e, 0x66, 0x3e, 0x00, 0x00, 0x66, 0x66, 0x7e,
  0x66, 0x66, 0x66, 0x00, 0x00, 0x7e, 0x18, 0x18, 0x18, 0x18, 0x7e, 0x00,
  0x00, 0x06, 0x06, 0x06, 0x06, 0x66, 0x3c, 0x00, 0x00, 0x66, 0x6c, 0x78,
  0x78, 0x6c, 0x66, 0x00, 0x00, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7e, 0x00,
  0x00, 0x63, 0x77, 0x7f, 0x6b, 0x63, 0x63, 0x00, 0x00, 0x66, 0x76, 0x7e,
  0x7e, 0x6e, 0x66, 0x00, 0x00, 0x3c, 0x66, 0x66, 0x66, 0x66, 0x3c, 0x00,
  0x00, 0x7c, 0x66, 0x66, 0x7c, 0x60, 0x60, 0x00, 0x00, 0x3c, 0x66, 0x66,
  0x66, 0x6c, 0x36, 0x00, 0x00, 0x7c, 0x66, 0x66, 0x7c, 0x6c, 0x66, 0x00,
  0x00, 0x3c, 0x60, 0x3c, 0x06, 0x06, 0x3c, 0x00, 0x00, 0x7e, 0x18, 0x18,
  0x18, 0x18, 0x18, 0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x66, 0x7e, 0x00,
  0x00, 0x66, 0x66, 0x66, 0x66, 0x3c, 0x18, 0x00, 0x00, 0x63, 0x63, 0x6b,
  0x7f, 0x77, 0x63, 0x00, 0x00, 0x66, 0x66, 0x3c, 0x3c, 0x66, 0x66, 0x00,
  0x00, 0x66, 0x66, 0x3c, 0x18, 0x18, 0x18, 0x00, 0x00, 0x7e, 0x0c, 0x18,
  0x30, 0x60, 0x7e, 0x00, 0x00, 0x1e, 0x18, 0x18, 0x18, 0x18, 0x1e, 0x00,
  0x00, 0x40, 0x60, 0x30, 0x18, 0x0c, 0x06, 0x00, 0x00, 0x78, 0x18, 0x18,
  0x18, 0x18, 0x78, 0x00, 0x00, 0x08, 0x1c, 0x36, 0x63, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00
};

/**
 * @brief Initial playfield data.
 */
unsigned char _board_pfdata[] = {
  0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb,
  0xdb, 0xdb, 0xdb, 0xdb, 0x0a, 0x00, 0x08, 0x00, 0x06, 0x00, 0x04, 0x00,
  0x02, 0x00, 0x06, 0x00, 0x08, 0x00, 0x0a, 0x00, 0x0b, 0x00, 0x09, 0x00,
  0x07, 0x00, 0x05, 0x00, 0x03, 0x00, 0x07, 0x00, 0x09, 0x00, 0x0b, 0x00,
  0x0c, 0x00, 0x0c, 0x00, 0x0c, 0x00, 0x0c, 0x00, 0x0c, 0x00, 0x0c, 0x00,
  0x0c, 0x00, 0x0c, 0x00, 0x0d, 0x00, 0x0d, 0x00, 0x0d, 0x00, 0x0d, 0x00,
  0x0d, 0x00, 0x0d, 0x00, 0x0d, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00,
  0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x01, 0x00,
  0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00,
  0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x00,
  0x01, 0x00, 0x01, 0x00, 0x8c, 0x00, 0x8c, 0x00, 0x8c, 0x00, 0x8c, 0x00,
  0x8c, 0x00, 0x8c, 0x00, 0x8c, 0x00, 0x8c, 0x00, 0x8d, 0x00, 0x8d, 0x00,
  0x8d, 0x00, 0x8d, 0x00, 0x8d, 0x00, 0x8d, 0x00, 0x8d, 0x00, 0x8d, 0x00,
  0x8a, 0x00, 0x88, 0x00, 0x86, 0x00, 0x84, 0x00, 0x82, 0x00, 0x86, 0x00,
  0x88, 0x00, 0x8a, 0x00, 0x8b, 0x00, 0x89, 0x00, 0x87, 0x00, 0x85, 0x00,
  0x83, 0x00, 0x87, 0x00, 0x89, 0x00, 0x8b, 0x00, 0xdb, 0xdb, 0xdb, 0xdb,
  0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb,
  0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb,
  0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb,
  0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb,
  0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb,
  0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb,
  0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb
};

/**
 * @Brief set up board playfield
 */
void board_pf(void)
{
  memset((void *)CHSET_ADDR, 0x00, 512);
  memcpy((void *)CHSET_ADDR, _board_fnt, 512);
  OS.chbas = 0x7A;
  memset((void *)BOARDPF_ADDR, 0x00, 360);
  memcpy((void *)BOARDPF_ADDR, &_board_pfdata, sizeof(_board_pfdata));
}

/**
 * @brief set up board player/missile graphics
 */
void board_pmg(void)
{
  memset((void *)PMG_ADDR, 0x00, 1024);
  memcpy((void *)PMG_ADDR, &_pmg_data, sizeof(_pmg_data));
  GTIA_WRITE.gractl = 0x1B; // player DMA, missile DMA
  OS.sdmctl = 0x2D; // narrow missiles players 2-line dlist
  ANTIC.pmbase = 0x7C; // 7c00
}

/**
 * @brief set up display list for board
 * @verbose Display list is at 0x0600
 */
void board_dlist(void)
{
  memset((void *)DLIST_ADDR,0x00,256);
  memcpy((void *)DLIST_ADDR, &_dlist, sizeof(_dlist));
  OS.sdlst = (void *)DLIST_ADDR;
}

/**
 * @brief set up board color palette
 */
void board_color(void)
{
  // Chess board background
  OS.pcolr0=
    OS.pcolr1=
    OS.pcolr2=
    OS.pcolr3=0x28;

  // Playfield colors
  OS.color0 = 0x00;
  OS.color1 = 0x7A;
  OS.color2 = 0x0e;
  OS.color3 = 0x34;
  OS.color4 = 0xC6;

  // Set P/M's behind playfield (pieces)
  OS.gprior = 0x14;

  // Position players and missiles (board bits)
  GTIA_WRITE.hposp0=0x3C;
  GTIA_WRITE.hposp1=0x5C;
  GTIA_WRITE.hposp2=0x7C;
  GTIA_WRITE.hposp3=0x9C;
  GTIA_WRITE.hposm0 = 0xBC;
  GTIA_WRITE.hposm1 =
    GTIA_WRITE.hposm2 =
    GTIA_WRITE.hposm3 = 0x38;  
  GTIA_WRITE.sizep0 =
    GTIA_WRITE.sizep1 =
    GTIA_WRITE.sizep2 =
    GTIA_WRITE.sizep3 = 0x03;
  GTIA_WRITE.sizem = 0xFF; // All four missiles size 3
}

/**
 * @brief color changing code
 */
void colorama(void)
{
  unsigned char i;
  
  while(1)
    {
      switch(cgetc())
	{
	case 'q':
	  board_color();
	  break;
	case 'a':
	  OS.pcolr0+=2;
	  OS.pcolr1+=2;
	  OS.pcolr2+=2;
	  OS.pcolr3+=2;
	  break;
	case 'z':
	  OS.pcolr0-=2;
	  OS.pcolr1-=2;
	  OS.pcolr2-=2;
	  OS.pcolr3-=2;
	  break;
	case 's':
	  OS.color0+=2;
	  break;
	case 'x':
	  OS.color0-=2;
	  break;
	case 'd':
	  OS.color1+=2;
	  break;
	case 'c':
	  OS.color1-=2;
	  break;
	case 'f':
	  OS.color2+=2;
	  break;
	case 'v':
	  OS.color2-=2;
	  break;
	case 'g':
	  OS.color3+=2;
	  break;
	case 'b':
	  OS.color3-=2;
	  break;
	case 'h':
	  OS.color4+=2;
	  break;
	case 'n':
	  OS.color4-=2;
	  break;

	case 'w':
	  sprintf((char *)0x81E0,"%02x%02x%02x%02x%02x%02x",OS.pcolr0, OS.color0, OS.color1, OS.color2, OS.color3, OS.color4);
	  for (i=0;i<32;i++)
	    {
	      if (MSG[i] < 32)
		MSG[i] += 64;
	      else if (MSG[i] < 96)
		MSG[i] -= 32;
	    }
	  break;
	}
    }
    
}

/**
 * @brief draw board
 */
void board(void)
{
  board_dlist();
  board_color();
  board_pmg();
  board_pf();
  colorama();
}

/**
 * @brief test harness
 */
void main(void)
{
  board();
  while(1);
}
