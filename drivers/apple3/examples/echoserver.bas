50 REM SET UP A PORT AND WAIT FOR A CONNECTION60 INVOKE "REQUEST.INV"80 NET$=".NETWORK"100 PRINT "ECHO SERVER STARTED."110 PRINT "LISTENING FOR CONNECTION..."120 F$="N:TCP://:6502/"130 R=4:W=8135 F=0:RW=R+W:TR=0140 PRINT "OPEN ";F$150 OPEN #1,NET$160 CNUM=ASC("O")170 CCMD$=CHR$(RW)+CHR$(TR)+F$+CHR$(0)+CHR$(LEN(F$)+1)180 CLIST$=CHR$(LEN(CCMD$)-1)+CCMD$190 PERFORM CONTROL(%CNUM,@CLIST$)NET$200 REM WAIT FOR CONNECTION, WHEN CN IS NOT ZERO, THEN CONNECTION WILL BE DETECTED210 GOSUB 900:REM GET NW STATUS220 IF CN%=0 THEN 200230 PRINT "CONNECTION DETECTED! (";CN%;")"300 REM ACCEPT THE CONNECTION!310 CNUM=ASC("A")320 CLIST$=CHR$(0)330 PERFORM CONTROL(%CNUM,@CLIST$)NET$340 REM PRINT "ACCEPTED CONNECTION."400 REM SEE IF THERE IS SOMETHING TO READ410 GOSUB 900:REM GET NW STATUS420 REM IF WE'VE LOST THE CONNECTION, THEN QUIT430 IF CN%=0 THEN 600440 REM IF THERE ARE NO CHARACTERS TO READ, THEN WAIT UNTIL THERE IS450 IF BW%=0 THEN 400460 REM READ THE CHARACTER AND SEND IT OUT470 INPUT #1;A$480 PRINT "<";A$490 PRINT ">";A$500 PRINT #1;A$510 GOTO 400600 PRINT:PRINT "DISCONNECTED.":CLOSE #1610 GOTO 110900 REM Get Network status910 STATNUM%=ASC("S")920 STATBUF$=""930 PERFORM STATUS(%STATNUM%,@STATBUF$)NET$940 BW%=ASC(MID$(STATBUF$,2,1))*256+ASC(MID$(STATBUF$,1,1))950 CN%=ASC(MID$(STATBUF$,3,1))960 ER%=ASC(MID$(STATBUF$,4,1))970 RETURN1000 END