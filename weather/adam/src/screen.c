/**
 * Weather
 *
 * Screen Routines
 */


#include <video/tms99x8.h>
#include <eos.h>
#include <smartkeys.h>
#include <conio.h>
#include <sys/ioctl.h>
#include <stdbool.h>
#include "screen.h"
#include "constants.h"
#include "ftime.h"
#include "options.h"
#include "forecast.h"

char tmp[192]; // Temporary for screen formatting

unsigned short screen_icon_counter;
extern unsigned char forecast_offset;

extern OptionsData optData;

const unsigned char spritedata[] = {
    // 0 Sunny
    0x04, 0x44, 0x20, 0x07, 0x0F, 0x1F, 0x1F, 0x1F, 0xDF, 0x1F, 0x1F, 0x0F, 0x07, 0x20, 0x44, 0x04, 0x20, 0x22, 0x04, 0xE0, 0xF0, 0xF8, 0xF8, 0xF8, 0xFB, 0xF8, 0xF8, 0xF0, 0xE0, 0x04, 0x22, 0x20,

    // 1 Half Sunny
    0x04, 0x44, 0x20, 0x07, 0x0F, 0x9F, 0x5F, 0x1F, 0x1F, 0x1F, 0x1F, 0x0F, 0x07, 0x00, 0x00, 0x00, 0x20, 0x22, 0x04, 0xE0, 0xF1, 0xFA, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0xF0, 0xE0, 0x00, 0x00, 0x00,

    // 2 Cloud 1
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x07, 0x6F, 0xFF, 0xFF, 0xFF, 0x7F, 0x1F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xCC, 0xFE, 0xFF, 0xFF, 0xFF, 0xFE, 0xF8, 0xF0,

    // 3 Cloud 2
    0x00, 0x00, 0x00, 0x03, 0x07, 0x6F, 0xFF, 0xFF, 0xFF, 0x7F, 0x1F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xCC, 0xFE, 0xFF, 0xFF, 0xFF, 0xFE, 0xF8, 0xF0, 0x00, 0x00, 0x00, 0x00,

    // 4 Cloud 3
    0x00, 0x00, 0x03, 0x07, 0x6F, 0xFF, 0xFF, 0xFF, 0x7F, 0x1F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xCC, 0xFE, 0xFF, 0xFF, 0xFF, 0xFE, 0xF8, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00,

    // 5 Cloud 4
    0x03, 0x07, 0x6F, 0xFF, 0xFF, 0xFF, 0x7F, 0x1F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xCC, 0xFE, 0xFF, 0xFF, 0xFF, 0xFE, 0xF8, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    // 6 Mist 1
    0x05, 0x00, 0x20, 0x00, 0x40, 0x00, 0x80, 0x00, 0x20, 0x00, 0x40, 0x00, 0x10, 0x00, 0x0B, 0x00, 0xB4, 0x00, 0x08, 0x00, 0x02, 0x00, 0x01, 0x00, 0x02, 0x00, 0x01, 0x00, 0x02, 0x00, 0x68, 0x00,

    // 7 Mist 2
    0x00, 0x00, 0x0D, 0x00, 0x1B, 0x00, 0x37, 0x00, 0x2F, 0x00, 0x1B, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0x00, 0xD8, 0x00, 0xEC, 0x00, 0xD8, 0x00, 0xEC, 0x00, 0xD0, 0x00, 0x00, 0x00,

    // 8 Moon
    0x03, 0x0F, 0x1F, 0x3F, 0x3E, 0x7E, 0x7C, 0x7C, 0x7C, 0x7C, 0x7E, 0x3E, 0x3F, 0x1F, 0x0F, 0x03, 0xE0, 0xF0, 0xFC, 0x84, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x84, 0xFC, 0xF0, 0xE0,

    // 9 Cloud 5
    0x03, 0x07, 0x6F, 0xFF, 0xFF, 0xFF, 0x7F, 0x1F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xCC, 0xFE, 0xFF, 0xFF, 0xFF, 0xFE, 0xF8, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    // A Cloud 6
    0x03, 0x07, 0x6F, 0xFF, 0xFF, 0xFF, 0x7F, 0x1F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xCC, 0xFE, 0xFF, 0xFF, 0xFF, 0xFE, 0xF8, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    // B Lightning 1
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x06, 0x0F, 0x00, 0x00, 0x01, 0x07, 0x03, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x80, 0x00, 0x00, 0xF0, 0x60, 0xC0, 0x80, 0xC0, 0x80, 0x00,

    // C Lightning 2
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x00, 0x00, 0x00, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0xC0, 0x80, 0x00, 0xF8, 0x30, 0x60, 0xC0, 0xE0, 0xC0, 0x00,

    // D Rain 1
    0x00, 0x00, 0x00, 0x00, 0x08, 0x0A, 0x02, 0x10, 0x14, 0x05, 0x21, 0x28, 0x0A, 0x42, 0x50, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x84, 0xA0, 0x2A, 0x0A, 0x40, 0x54, 0x14, 0x80, 0xA8, 0x20,

    // E Rain 2
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x21, 0x28, 0x0A, 0x42, 0x50, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x41, 0x55, 0x14, 0x80, 0xAA, 0x22,

    // F Snow 1
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x0A, 0x04, 0x20, 0x51, 0x20, 0x00, 0x44, 0xE0, 0x40, 0x00, 0x00, 0x00, 0x80, 0x00, 0x20, 0x50, 0x22, 0x05, 0x92, 0x40, 0x90, 0x00, 0x4A, 0xE0, 0x44,

    // 10 Snow 2
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x24, 0x80, 0x15, 0x4A, 0xA4, 0x49, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x02, 0x00, 0x84, 0x01, 0x12, 0x45, 0xA2, 0x48,

    // 11 Lightning 3
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x60, 0xC0, 0x80, 0xFC, 0x18, 0x30, 0x60, 0xF0, 0xE0, 0x80};

// udgs = user defined graphics set
const unsigned char udgs[] = {
    // Digits 0-9 as 16x16 chars
    0x03, 0x0F, 0x0C, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x0C, 0x0F, 0x03, 0xC0, 0xF0, 0x30, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x30, 0xF0, 0xC0,
    0x01, 0x03, 0x07, 0x07, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x07, 0x07, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xE0, 0xE0,
    0x03, 0x0F, 0x0C, 0x18, 0x18, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x0E, 0x1C, 0x18, 0x1F, 0x1F, 0xC0, 0xF0, 0x30, 0x18, 0x18, 0x38, 0x70, 0xE0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0xF8, 0xF8,
    0x03, 0x0F, 0x0C, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x0C, 0x0F, 0x03, 0xC0, 0xF0, 0x30, 0x18, 0x18, 0x18, 0x30, 0xE0, 0xE0, 0x30, 0x18, 0x18, 0x18, 0x30, 0xF0, 0xC0,
    0x01, 0x01, 0x03, 0x03, 0x06, 0x06, 0x0C, 0x0C, 0x18, 0x18, 0x3F, 0x3F, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xF0, 0xF0, 0xC0, 0xC0, 0xC0, 0xC0,
    0x1F, 0x1F, 0x18, 0x18, 0x18, 0x18, 0x1B, 0x1F, 0x1C, 0x00, 0x00, 0x18, 0x18, 0x0C, 0x0F, 0x03, 0xF8, 0xF8, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xF0, 0x30, 0x18, 0x18, 0x18, 0x18, 0x30, 0xF0, 0xC0,
    0x03, 0x0F, 0x0C, 0x18, 0x18, 0x18, 0x1B, 0x1F, 0x1C, 0x18, 0x18, 0x18, 0x18, 0x0C, 0x0F, 0x03, 0xC0, 0xF0, 0x30, 0x18, 0x18, 0x00, 0xC0, 0xF0, 0x30, 0x18, 0x18, 0x18, 0x18, 0x30, 0xF0, 0xC0,
    0x0F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03, 0xF8, 0xF8, 0x30, 0x30, 0x60, 0x60, 0x60, 0xC0, 0xC0, 0xC0, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
    0x03, 0x0F, 0x0C, 0x18, 0x18, 0x18, 0x0C, 0x07, 0x07, 0x0C, 0x18, 0x18, 0x18, 0x0C, 0x0F, 0x03, 0xC0, 0xF0, 0x30, 0x18, 0x18, 0x18, 0x30, 0xE0, 0xE0, 0x30, 0x18, 0x18, 0x18, 0x30, 0xF0, 0xC0,
    0x03, 0x0F, 0x0C, 0x18, 0x18, 0x18, 0x18, 0x1C, 0x0F, 0x03, 0x00, 0x18, 0x18, 0x0C, 0x0F, 0x03, 0xC0, 0xF0, 0x30, 0x18, 0x18, 0x18, 0x18, 0x38, 0xF8, 0xD8, 0x18, 0x18, 0x18, 0x30, 0xF0, 0xC0,

    // Degree symbol
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x3C, 0x66, 0x66, 0x3C, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    // Negative symbol
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7C, 0x7C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    // . symbol
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x38, 0x38,

    // FARENHEIT
    0x1F, 0x1F, 0x18, 0x18, 0x18, 0x18, 0x18, 0x1F, 0x1F, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xF8, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    // CELSIUS
    0x03, 0x0F, 0x0C, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x0C, 0x0F, 0x03, 0xC0, 0xF0, 0x30, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x30, 0xF0, 0xC0,

    // DEGREE SMALL
    0x04, 0x0A, 0x0A, 0x04, 0x00, 0x00, 0x00, 0x00};

const char logo_udgs[] = {
    // logo data
    0xff, 0xff, 0xc0, 0xc0, 0xc0, 0xc0, 0xff, 0xff, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
    0x18, 0x18, 0x18, 0x18, 0x18, 0x19, 0x1b, 0x19, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0x00, 0x18, 0x18, 0x1c, 0x0c, 0x0f, 0x07, 0x01, 0x00, 0x06, 0x06, 0x0e, 0x0c, 0x3c, 0xf8, 0xe0, 0x00,
    0x03, 0x03, 0x03, 0x43, 0xe7, 0x7e, 0x3c, 0x00, 0x19, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x08, 0x0c, 0x0e, 0x0f, 0x0f, 0x0d, 0x8c, 0x0c, 0x01, 0x01, 0x01, 0x01, 0x81, 0xc1, 0xe1, 0x71,
    0x8f, 0x8f, 0x8c, 0x8c, 0x8c, 0x8c, 0x8f, 0x8f, 0xf3, 0xf3, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xf0, 0xff, 0xff, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0xcc, 0x0c, 0x00,
    0x39, 0x1d, 0x0f, 0x07, 0x03, 0x01, 0x00, 0x00, 0x8c, 0x8c, 0x8c, 0x8c, 0x8c, 0x8f, 0x8f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xf0, 0x00, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x00,
    0x04, 0x04, 0x04, 0x0e, 0x1f, 0x3f, 0xff, 0x3f, 0x7f, 0x3e, 0x1c, 0x1c, 0x22, 0xc1, 0xc1, 0xc1, 0x10, 0x10, 0x10, 0x38, 0x7c, 0xfe, 0xff, 0xfe, 0x1f, 0x0e, 0x04, 0x04, 0x04, 0x1f, 0x04, 0x04,
    0x22, 0x1c, 0x08, 0x08, 0x08, 0xff, 0x08, 0x08, 0x7c, 0x38, 0x38, 0x7c, 0xfe, 0xff, 0xfe, 0x7c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x04, 0x1f, 0x00, 0x08, 0x08, 0x08, 0x1c, 0x3e, 0x7f, 0xff,
    0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x10, 0xfe, 0x08, 0x08, 0x08, 0x1f, 0x08, 0x00, 0x00, 0x00, 0x38, 0x10, 0x10, 0xff, 0x10, 0x10, 0x10, 0x00, 0x10, 0x10, 0x10, 0xfc, 0x10, 0x10, 0x00, 0x00};

void screen_init(void) { 
    clrscr(); 
}

void screen_colors(unsigned long d, short offset, unsigned char *fg, unsigned char *bg, bool *dayNight)
{
    Timestamp ts;

    timestamp(d + offset, &ts);

    switch (ts.hour)
    {
    case 0:
    case 1:
    case 2:
    case 3:
    case 4:
        *dayNight = false;
        *fg = VDP_INK_WHITE;
        *bg = VDP_INK_BLACK;
        break;
    case 5:
    case 6:
    case 7:
        *dayNight = true;
        *bg = VDP_INK_DARK_BLUE;
        *fg = VDP_INK_WHITE;
        break;
    case 8:
    case 9:
    case 10:
        *dayNight = true;
        *bg = VDP_INK_LIGHT_BLUE;
        *fg = VDP_INK_WHITE;
        break;
    case 11:
    case 12:
    case 13:
    case 14:
    case 15:
    case 16:
        *dayNight = true;
        *bg = VDP_INK_CYAN;
        *fg = VDP_INK_BLACK;
        break;
    case 17:
    case 18:
    case 19:
        *dayNight = false;
        *bg = VDP_INK_DARK_BLUE;
        *fg = VDP_INK_WHITE;
        break;
    case 20:
    case 21:
    case 22:
    case 23:
        *dayNight = false;
        *bg = VDP_INK_BLACK;
        *fg = VDP_INK_WHITE;
        break;
    default:
        break;
    }
}

void screen_bigprint_offsets(char *c, unsigned char *c0, unsigned char *c1, unsigned char *c2, unsigned char *c3)
{
    // 0 2 1 3
    unsigned char o = 0x80; // Initial char offset
    char t = *c;

    switch (t)
    {
    case '*':
        o += 0x28;
        break;
    case '-':
        o += 0x2C;
        break;
    case '.':
        o += 0x30;
        break;
    case 'F':
        o += 0x34;
        break;
    case 'C':
        o += 0x38;
        break;
    default:
        t -= 0x30;
        t *= 4;
        t += 0x80;
        o = t;
        break;
    }

    *c0 = o;
    *c1 = o + 2;
    *c2 = o + 1;
    *c3 = o + 3;
}

void screen_bigprint(unsigned char x, unsigned char y, char *c)
{
    x <<= 2;
    y <<= 2;

    while (*c != 0x00)
    {
        unsigned char c0, c1, c2, c3;

        screen_bigprint_offsets(c, &c0, &c1, &c2, &c3);
        if ((*c == '.') || (*c == '*'))
        {
            gotoxy(x, y);
            cprintf("%c", c1);
            gotoxy(x, y + 1);
            cprintf("%c", c3);
            x += 1;
        }
        else
        {
            gotoxy(x, y);
            cprintf("%c%c", c0, c1);
            gotoxy(x, y + 1);
            cprintf("%c%c", c2, c3);
            x += 2;
        }
        c++;
    }
}

/*
screen_icon_reset 
- sets the global variable screen_icon_counter to the start of sprite data
*/
void screen_icon_reset(void) 
{ 
    screen_icon_counter = 0x1B00; 
}


/*
screen_icon 
- positions a sprite for the weather on the screen

Parameters
- x - X position on screen (0 -> )
- y - Y position on screen (0 -> )
- unused
- icon - Sprite to display, see constants.h
- dayNight - use day sprite if true
*/
void screen_icon(unsigned char x, unsigned char y, unsigned char unused, unsigned char icon, bool dayNight)
{
    // blast all sprites
    vdp_vfill(0x1b00, 0, 128);
    screen_icon_reset();

    switch (icon)
    {
    case ICON_CLEAR_SKY: // clear sky
        // Sun with clouds
        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, dayNight == true ? 0x00 : 32);
        vdp_vpoke(screen_icon_counter++, 0x0A);
        break;
    case ICON_FEW_CLOUDS: // few clouds
        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 0x08);
        vdp_vpoke(screen_icon_counter++, 0x0F);

        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, dayNight == true ? 0x04 : 32);
        vdp_vpoke(screen_icon_counter++, 0x0A);
        break;
    case ICON_SCATTERED_CLOUDS: // Scattered clouds
        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 0x10);
        vdp_vpoke(screen_icon_counter++, 0x0F);
        break;
    case ICON_BROKEN_CLOUDS: // broken clouds
        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 16);
        vdp_vpoke(screen_icon_counter++, 0x0e);

        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 20);
        vdp_vpoke(screen_icon_counter++, 0x01);
        break;
    case ICON_SHOWER_RAIN: // shower rain
        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 56);
        vdp_vpoke(screen_icon_counter++, 0x04);

        if (dayNight == true)
        {
            vdp_vpoke(screen_icon_counter++, y);
            vdp_vpoke(screen_icon_counter++, x);
            vdp_vpoke(screen_icon_counter++, 16);
            vdp_vpoke(screen_icon_counter++, 0x0e);

            vdp_vpoke(screen_icon_counter++, y);
            vdp_vpoke(screen_icon_counter++, x);
            vdp_vpoke(screen_icon_counter++, 20);
            vdp_vpoke(screen_icon_counter++, 0x01);
        }
        else
        {
            vdp_vpoke(screen_icon_counter++, y);
            vdp_vpoke(screen_icon_counter++, x);
            vdp_vpoke(screen_icon_counter++, 0x08);
            vdp_vpoke(screen_icon_counter++, 0x0F);

            vdp_vpoke(screen_icon_counter++, y);
            vdp_vpoke(screen_icon_counter++, x);
            vdp_vpoke(screen_icon_counter++, dayNight == true ? 0x04 : 32);
            vdp_vpoke(screen_icon_counter++, 0x0A);
        }
        break;
    case ICON_RAIN: // rain
        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 56);
        vdp_vpoke(screen_icon_counter++, 0x04);

        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 8);
        vdp_vpoke(screen_icon_counter++, 0x0F);

        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 4);
        vdp_vpoke(screen_icon_counter++, 0x0A);
        break;
    case ICON_THUNDERSTORM: // thunderstorm
        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 48);
        vdp_vpoke(screen_icon_counter++, 0x0A);

        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 16);
        vdp_vpoke(screen_icon_counter++, 0x0e);

        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 20);
        vdp_vpoke(screen_icon_counter++, 0x01);

        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 56);
        vdp_vpoke(screen_icon_counter++, 0x04);
        break;

    case ICON_SNOW: // snow
        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 60);
        vdp_vpoke(screen_icon_counter++, 0x0e);

        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 16);
        vdp_vpoke(screen_icon_counter++, 0x0f);

        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 20);
        vdp_vpoke(screen_icon_counter++, 0x01);

    case ICON_MIST: // mist
        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 28);
        vdp_vpoke(screen_icon_counter++, 0x0f);

        vdp_vpoke(screen_icon_counter++, y);
        vdp_vpoke(screen_icon_counter++, x);
        vdp_vpoke(screen_icon_counter++, 24);
        vdp_vpoke(screen_icon_counter++, 0x0e);
        break;
    }
}

void screen_daily(char *date, unsigned char icon, char *temperature, char *pressure, char *description, char *location, char *wind, char *feels, char *dew, char *visibility, char *timezone,
                  char *sunrise, char *sunset, char *humidity, char *clouds, char *time, unsigned char foregroundColor, unsigned char backgroundColor, bool dayNight)
{
    void *param = &udgs;
    int x_start;

    screen_icon_reset();
    console_ioctl(IOCTL_GENCON_SET_UDGS, &param);
    vdp_color(foregroundColor, backgroundColor, backgroundColor);
    clrscr();

    eos_write_vdp_register(1, 0xE3);
    vdp_vwrite(spritedata, 0x3800, sizeof(spritedata));

    if (optData.units == IMPERIAL)
        strcpy(tmp, "  SHOW\n CELSIUS");
    else
        strcpy(tmp, "  SHOW\nFARENHEIT");

    smartkeys_display(NULL, NULL, "LOCATION", "FORE\nCAST", tmp, " REFRESH");

    vdp_color(foregroundColor, backgroundColor, backgroundColor);

    gotoxy(8, 0);
    cprintf("%s", date);
    screen_icon(24, 24, 0, icon, dayNight);
    screen_bigprint(2, 1, temperature);
    gotoxy(23, 4);
    cprintf("%s", pressure);
    x_start = 36/2 - strlen(description)/2;
    if (x_start < 0)
        x_start = 0;
    gotoxy(x_start, 7);
    cprintf("%s", description);

    gotoxy(12, 9);
    cprintf("%s", location);

    sprintf(tmp, "WIND: %s\nFEELS LIKE: %s\n\nDEW POINT: %s\nVISIBILITY: %s\n\nTIME ZONE: %s", wind, feels, dew, visibility, timezone);
    smartkeys_puts(0, 96, tmp);

    sprintf(tmp, "SUNRISE: %s\nSUNSET: %s\n\nHUMIDITY: %s\nCLOUDS: %s\n\nTIME: %s", sunrise, sunset, humidity, clouds, time);
    smartkeys_puts(160, 96, tmp);
}

// initial splash screen

void screen_welcome(void)
{
    void *param = &logo_udgs;

    // Use custom font
    console_ioctl(IOCTL_GENCON_SET_UDGS, &param);
    smartkeys_set_mode();

             // Fujinet Logo
    printf("\x20\x20\x20\x20\x20\x9A\x9B\x9C\x20\x20\x20\x20\x20       OPEN WEATHER");
    printf("\x80\x81\x82\x83\x84\x94\x95\x96\x8A\x8B\x8C\x8D\x8e          CLIENT\n");
    printf("\x85\x86\x87\x88\x89\x97\x98\x99\x8F\x90\x91\x92\x93           for\n");
    printf("\x20\x20\x20\x20\x20\x20\x9D\x9E\x9F\x20\x20\x20\x20       COLECO  ADAM\n");
}

// Step 2
void screen_options_init(void)
{
    smartkeys_display(NULL, NULL, NULL, NULL, NULL, NULL);
    smartkeys_status("\n  INITIALIZING OPTIONS...");
}


void screen_options_init_not_found(void)
{
    smartkeys_display(NULL, NULL, NULL, NULL, NULL, NULL);
    smartkeys_status("\n  NO OPTIONS FOUND, USING DEFAULTS.");
}

void screen_options_could_not_save(void)
{
    smartkeys_display(NULL, NULL, NULL, NULL, NULL, NULL);
    smartkeys_status("\n  COULD NOT SAVE OPTIONS.");
}

void screen_location_detect(void)
{
    smartkeys_display(NULL, NULL, NULL, NULL, NULL, NULL);
    smartkeys_status("\n  DETECTING YOUR LOCATION...");
}

void screen_weather_init(void)
{
    smartkeys_display(NULL, NULL, NULL, NULL, NULL, NULL);
    smartkeys_status("\n  RETRIEVING WEATHER INFORMATION...");
}

// step 4
void screen_weather_could_not_get()
{
    smartkeys_display(NULL, NULL, NULL, NULL, NULL, NULL);
    smartkeys_status("\n  COULD NOT RETRIEVE WEATHER DATA.");
}

// step 3
void screen_weather_parsing()
{
    smartkeys_display(NULL, NULL, NULL, NULL, NULL, NULL);
    smartkeys_status("\n  PARSING WEATHER DATA...");
}

void screen_forecast_init(void)
{
    clrscr();
    eos_write_vdp_register(1, 0xE3);
    vdp_vwrite(spritedata, 0x3800, sizeof(spritedata));
    screen_icon_reset();
}

void screen_forecast_parsing(void)
{
    smartkeys_display(NULL, NULL, NULL, NULL, NULL, NULL);
    smartkeys_status("\n  PARSING FORECAST DATA, PLEASE WAIT...");
}

void screen_forecast(unsigned char i, ForecastData *f, unsigned char foregroundColor, unsigned char backgroundColor, bool day)
{
    //                    i  D  d   l   h
    unsigned char x[5] = {0, 7, 13, 21, 27};
    unsigned char iy[5] = {40, 80, 120, 160};
    unsigned char y = (i % 4) * 4;
    void *param = &udgs;

    if (y == 0)
    {
        screen_icon_reset();
        console_ioctl(IOCTL_GENCON_SET_UDGS, &param);
        vdp_color(foregroundColor, backgroundColor, backgroundColor);
        clrscr();

        gotoxy(x[1],y);
        vdp_color(backgroundColor, foregroundColor, foregroundColor);
        cprintf("%25s", " ");

        gotoxy(x[1],y);
        cprintf(" DATE");

        gotoxy(x[2],y);
        cprintf(" DAY");

        gotoxy(x[3],y);
        cprintf("LOW");

        gotoxy(x[4],y);
        cprintf("HIGH");    
    }

    vdp_color(foregroundColor, backgroundColor, backgroundColor);
    y += 2;

    // icon
    screen_icon(8, iy[i], 0, f->icon, day);

    // date
    gotoxy(x[1],y);
    cprintf("%5s", f->date);

    // day of week
    gotoxy(x[2],y);
    cprintf("%-5s", f->dow);

    // Low
    gotoxy(x[3],y);
    cprintf("%5s", f->lo);

    // High
    gotoxy(x[4],y);
    cprintf("%5s", f->hi);

    y++;
    gotoxy(x[1],y);
    cprintf("%25s", f->desc);

}

void screen_forecast_keys(void)
{
    char tmp2[20];

    if (optData.units == IMPERIAL)
        strcpy(tmp, "  SHOW\n CELSIUS");
    else
        strcpy(tmp, "  SHOW\nFARENHEIT");

    if (forecast_offset == 0)
    {
        forecast_offset = 0;
        strcpy(tmp2, "  NEXT\n  PAGE");
    } else
    {
        forecast_offset = 4;
        strcpy(tmp2, "  PREV\n  PAGE");
    }
        
    smartkeys_display(NULL, tmp2, "LOCATION", "  SHOW\n DAILY", tmp, " REFRESH");
}
