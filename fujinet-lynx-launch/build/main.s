;
; File generated by cc65 v 2.19 - Git dcdf7ade0
;
	.fopt		compiler,"cc65 v 2.19 - Git dcdf7ade0"
	.setcpu		"65SC02"
	.smart		on
	.autoimport	on
	.case		on
	.debuginfo	off
	.importzp	sp, sreg, regsave, regbank
	.importzp	tmp1, tmp2, tmp3, tmp4, ptr1, ptr2, ptr3, ptr4
	.macpack	longbranch
	.forceimport	__STARTUP__
	.import		_lynx_stdjoy_joy
	.import		_tgi_static_stddrv
	.import		_tgi_install
	.import		_tgi_init
	.import		_tgi_clear
	.import		_tgi_setcolor
	.import		_tgi_outtext
	.import		_tgi_outtextxy
	.import		_tgi_ioctl
	.import		_joy_install
	.import		_sprintf
	.import		_sleep
	.import		_strcpy
	.import		_LynxGD_Init
	.import		_LynxGD_OpenFile
	.import		_LynxGD_WriteFile
	.import		_LynxGD_CloseFile
	.import		_LynxGD_Program
	.import		_LaunchROM
	.import		_fujinet_init
	.import		_fujinet_send
	.import		_fujinet_recv
	.export		_buffer
	.export		_esm
	.export		_main

.segment	"RODATA"

S0008:
	.byte	$31,$34,$30,$2E,$31,$34,$31,$2E,$31,$35,$33,$2E,$35,$37,$00
S0004:
	.byte	$2F,$6E,$65,$74,$6C,$6F,$61,$64,$2E,$6C,$6E,$78,$00
S0009	:=	S0004+1
S0006:
	.byte	$4C,$4F,$41,$44,$49,$4E,$47,$00
S0002:
	.byte	$4F,$50,$45,$4E,$49,$4E,$47,$00
S000A:
	.byte	$20,$50,$52,$4F,$00
S0007:
	.byte	$20,$43,$4C,$4F,$00
S0005:
	.byte	$25,$75,$00
S0003:
	.byte	$D7,$00

.segment	"BSS"

_buffer:
	.res	256,$00
_esm:
	.res	67,$00

; ---------------------------------------------------------------
; void __near__ main (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_main: near

.segment	"CODE"

	stz     sreg
	stz     sreg+1
	stz     M0001
	stz     M0001+1
	ldy     sreg
	sty     M0001+2
	ldy     sreg+1
	sty     M0001+3
	jsr     _fujinet_init
	lda     #<(_lynx_stdjoy_joy)
	ldx     #>(_lynx_stdjoy_joy)
	jsr     _joy_install
	jsr     _LynxGD_Init
	lda     #<(_tgi_static_stddrv)
	ldx     #>(_tgi_static_stddrv)
	jsr     _tgi_install
	jsr     _tgi_init
	lda     #$03
	jsr     pusha
	ldx     #$00
	lda     #$3C
	jsr     _tgi_ioctl
	cli
	lda     #$0F
	jsr     _tgi_setcolor
	jsr     _tgi_clear
	jsr     push0
	jsr     push0
	lda     #<(S0002)
	ldx     #>(S0002)
	jsr     _tgi_outtextxy
	lda     #$0F
	jsr     pusha
	lda     #<(S0003)
	ldx     #>(S0003)
	jsr     pushax
	lda     #$01
	jsr     pusha0
	jsr     _fujinet_send
	ldx     #$00
	lda     #$02
	jsr     _sleep
	lda     #<(S0004)
	ldx     #>(S0004)
	jsr     _LynxGD_OpenFile
	sta     M0002
	stx     M0002+1
	cpx     #$00
	bne     L0008
	cmp     #$00
	beq     L000A
L0008:	lda     #<(M0003)
	ldx     #>(M0003)
	jsr     pushax
	lda     #<(S0005)
	ldx     #>(S0005)
	jsr     pushax
	lda     M0002
	ldx     M0002+1
	jsr     pushax
	ldy     #$06
	jsr     _sprintf
	lda     #<(M0003)
	ldx     #>(M0003)
	jmp     _tgi_outtext
L000A:	jsr     pushax
	lda     #$08
	jsr     pushax
	lda     #<(S0006)
	ldx     #>(S0006)
	jsr     _tgi_outtextxy
	stz     sreg
	stz     sreg+1
	stz     M0001
	stz     M0001+1
	ldy     sreg
	sty     M0001+2
	ldy     sreg+1
	sty     M0001+3
L0004:	lda     M0001+3
	sta     sreg+1
	lda     M0001+2
	sta     sreg
	lda     M0001
	cmp     #$00
	lda     M0001+1
	sbc     #$04
	lda     sreg
	sbc     #$00
	lda     sreg+1
	sbc     #$00
	bcs     L0005
	lda     #$04
	jsr     pusha
	lda     #<(M0001)
	ldx     #>(M0001)
	jsr     pushax
	lda     #$05
	jsr     pusha0
	jsr     _fujinet_send
	lda     #$04
	jsr     pusha
	lda     #<(_buffer)
	ldx     #>(_buffer)
	jsr     pushax
	lda     #<(M0004)
	ldx     #>(M0004)
	jsr     pushax
	jsr     _fujinet_recv
	lda     #$04
	jsr     pusha
	lda     #<(_buffer)
	ldx     #>(_buffer)
	jsr     pushax
	lda     #<(M0004)
	ldx     #>(M0004)
	jsr     pushax
	jsr     _fujinet_recv
	lda     #<(_buffer)
	ldx     #>(_buffer)
	jsr     pushax
	ldx     #$01
	lda     #$00
	jsr     _LynxGD_WriteFile
	ldy     #<(M0001)
	sty     ptr1
	ldy     #>(M0001)
	jsr     laddeq1
	bra     L0004
L0005:	jsr     _LynxGD_CloseFile
	lda     #<(S0007)
	ldx     #>(S0007)
	jsr     _tgi_outtext
	lda     #$F0
	sta     _esm
	ldx     #$19
	lda     #$66
	sta     _esm+1
	stx     _esm+1+1
	lda     #<(_esm+3)
	ldx     #>(_esm+3)
	jsr     pushax
	lda     #<(S0008)
	ldx     #>(S0008)
	jsr     _strcpy
	lda     #$0F
	jsr     pusha
	lda     #<(_esm)
	ldx     #>(_esm)
	jsr     pushax
	lda     #$43
	jsr     pusha0
	jsr     _fujinet_send
	lda     #<(S0009)
	ldx     #>(S0009)
	jsr     _LynxGD_Program
	lda     #<(S000A)
	ldx     #>(S000A)
	jsr     _tgi_outtext
	jmp     _LaunchROM

.segment	"BSS"

M0001:
	.res	4,$00
M0002:
	.res	2,$00
M0003:
	.res	3,$00
M0004:
	.res	2,$00

.endproc

